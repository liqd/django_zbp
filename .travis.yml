language: python
python:
  - "3.6"

addons:
  postgresql: 9.6
  apt:
    packages:
    - postgresql-9.6-postgis-2.3

services:
  - postgresql

cache:
  pip: true
  directories:
    - node_modules

install:
  - sudo apt-get install -y gdal-bin

before_script:
  - psql -U postgres -c "create extension postgis"
  - psql -c 'create database django_zbp;' -U postgres

script:
  - make install
  - yapf -r django_zbp/ bplan/ --diff
  - venv/bin/python3 manage.py makemigrations --dry-run --check --noinput
  - make fixtures

env:
  global:
    DJANGO_SETTINGS_MODULE='django_zbp.settings.travis'
